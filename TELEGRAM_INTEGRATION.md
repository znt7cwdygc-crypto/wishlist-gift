# ü§ñ Telegram Integration ‚Äî –ü—É–±–ª–∏—á–Ω—ã–π –∏ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é

–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∂–∏–º–æ–≤ –≤–∏—à–ª–∏—Å—Ç–∞, deep links –∏ –æ–ø–ª–∞—Ç—ã Stars.

---

## 1. –ü—É–±–ª–∏—á–Ω—ã–π –≤–∏—à–ª–∏—Å—Ç

### –°—Å—ã–ª–∫–∞

```
https://t.me/<bot_username>?start=<public_slug>
```

- **public_slug**: 10‚Äì16 —Å–∏–º–≤–æ–ª–æ–≤, `A-Z a-z 0-9 _ -`
- Payload –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤
- –ú–∞–ø–ø–∏–Ω–≥: `public_slug` ‚Üí `wishlist_id` (model_id) –≤ –ë–î

### UX –¥–∞—Ä–∏—Ç–µ–ª—è

| –®–∞–≥ | –≠–∫—Ä–∞–Ω |
|-----|-------|
| 1 | –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É ‚Üí –∫–∞—Ä—Ç–æ—á–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ + —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ |
| 2 | –í—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥–∞—Ä–æ–∫ ‚Üí –∫–Ω–æ–ø–∫–∞ **–ü–æ–¥–∞—Ä–∏—Ç—å –∑–∞ ‚≠ê 250** |
| 3 | –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Invoice (Stars, XTR) —Å –∫–Ω–æ–ø–∫–æ–π Pay |
| 4 | –ù–∞–∂–∏–º–∞–µ—Ç Pay ‚Üí –ø–ª–∞—Ç—ë–∂–Ω—ã–π —ç–∫—Ä–∞–Ω Telegram |
| 5 | –ï—Å–ª–∏ Stars –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Üí Telegram –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –¥–æ–∫—É–ø–∏—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫ –æ–ø–ª–∞—Ç–µ |
| 6 | –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ ‚Üí ¬´–ì–æ—Ç–æ–≤–æ, –ø–æ–¥–∞—Ä–æ–∫ –æ–ø–ª–∞—á–µ–Ω¬ª, –ø–æ–∑–∏—Ü–∏—è ¬´–ü–æ–¥–∞—Ä–µ–Ω–æ¬ª |

### –ë—ç–∫–µ–Ω–¥ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

| –î–µ–π—Å—Ç–≤–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞** | `order_id` (UUID), `wishlist_id`, `item_id`, `amount_xtr`, `status: created` |
| **–†–µ–∑–µ—Ä–≤** | `item_status: reserved` –Ω–∞ 5‚Äì10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –∏–Ω–≤–æ–π—Å–∞ |
| **–¢–∞–π–º–∞—É—Ç** | –ï—Å–ª–∏ –æ–ø–ª–∞—Ç—ã –Ω–µ—Ç ‚Üí —Å–Ω—è—Ç—å —Ä–µ–∑–µ—Ä–≤ |
| **pre_checkout_query** | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ–∑–∏—Ü–∏—è —Å–≤–æ–±–æ–¥–Ω–∞, —Å—É–º–º–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí `ok=true` |
| **successful_payment** | `status: paid`, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `telegram_payment_charge_id`, —Å–Ω—è—Ç—å reserved, `item_status: gifted` |
| **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | –ü–æ `telegram_payment_charge_id` –Ω–µ –Ω–∞—á–∏—Å–ª—è—Ç—å –¥–≤–∞–∂–¥—ã |

### –ö–Ω–æ–ø–∫–∏ —ç–∫—Ä–∞–Ω–∞ ¬´–í–∏—à–ª–∏—Å—Ç¬ª

- –ù–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏: **–ü–æ–¥–∞—Ä–∏—Ç—å ‚≠ê X**
- –°—Ç–∞—Ç—É—Å: **–°–≤–æ–±–æ–¥–Ω–æ** / **–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ** / **–ü–æ–¥–∞—Ä–µ–Ω–æ**

### –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

- –°–æ–æ–±—â–µ–Ω–∏–µ: *–ü–æ–¥–∞—Ä–æ–∫ –æ–ø–ª–∞—á–µ–Ω ‚≠ê X. –•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É?*
- –ö–Ω–æ–ø–∫–∏: **–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ** / **–ë–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è**

---

## 2. –í–∏—à–ª–∏—Å—Ç –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)

### –°—Ö–µ–º–∞ 2.1: –°—Å—ã–ª–∫–∞ + –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω

**–°—Å—ã–ª–∫–∞:** `https://t.me/<bot_username>?start=<invite_token>`

- **invite_token**: –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π, –∂–∏–≤—ë—Ç 7 –¥–Ω–µ–π –∏–ª–∏ –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –í –ë–î: `invite_token` ‚Üí `wishlist_id`, `max_uses`, `allowed_user_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**UX –¥–∞—Ä–∏—Ç–µ–ª—è**

| –®–∞–≥ | –≠–∫—Ä–∞–Ω |
|-----|-------|
| 1 | ¬´–í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –≤–∏—à–ª–∏—Å—Ç &lt;–∏–º—è&gt;¬ª |
| 2 | –ö–Ω–æ–ø–∫–∏: **–û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫** / **–û—Ç–º–µ–Ω–∞** |
| 3 | –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ‚Äî –∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ (used), –ø–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ |
| 4 | –û–ø–ª–∞—Ç–∞ –∫–∞–∫ –≤ –ø—É–±–ª–∏—á–Ω–æ–º —Ä–µ–∂–∏–º–µ |

**–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç—ë–∫/–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω:**
- ¬´–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—É—é —É –≤–ª–∞–¥–µ–ª—å—Ü–∞.¬ª

### –°—Ö–µ–º–∞ 2.2: –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ + allowlist

**–°—Å—ã–ª–∫–∞:** –∫–∞–∫ –ø—É–±–ª–∏—á–Ω–∞—è `...?start=<public_slug>`

- –ï—Å–ª–∏ `user_id` –¥–∞—Ä–∏—Ç–µ–ª—è –Ω–µ –≤ allowlist ‚Üí —ç–∫—Ä–∞–Ω ¬´–ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø¬ª
- –í–ª–∞–¥–µ–ª–µ—Ü –ø–æ–ª—É—á–∞–µ—Ç: *–†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø @username?* ‚Üí **–†–∞–∑—Ä–µ—à–∏—Ç—å** / **–û—Ç–∫–ª–æ–Ω–∏—Ç—å**

**UX –¥–∞—Ä–∏—Ç–µ–ª—è**

| –®–∞–≥ | –≠–∫—Ä–∞–Ω |
|-----|-------|
| 1 | ¬´–≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Å–ø–∏—Å–æ–∫. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø?¬ª |
| 2 | –ö–Ω–æ–ø–∫–∏: **–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø** / **–ù–∞–∑–∞–¥** |
| 3 | –í–ª–∞–¥–µ–ª–µ—Ü –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç ‚Üí ¬´–î–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç¬ª ‚Üí —Å–ø–∏—Å–æ–∫ ‚Üí –æ–ø–ª–∞—Ç–∞ |

**–≠–∫—Ä–∞–Ω –≤–ª–∞–¥–µ–ª—å—Ü–∞**

- *–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –æ—Ç @username*
- –ö–Ω–æ–ø–∫–∏: **–†–∞–∑—Ä–µ—à–∏—Ç—å** / **–û—Ç–∫–ª–æ–Ω–∏—Ç—å**

---

## 3. Mini App (startapp)

**–°—Å—ã–ª–∫–∞:**
```
https://t.me/<bot_username>/<appname>?startapp=<payload>
```

- –í Mini App: `tgWebAppStartParam` = payload
- **–ü—É–±–ª–∏—á–Ω—ã–π:** payload = `public_slug`
- **–ü—Ä–∏–≤–∞—Ç–Ω—ã–π:** payload = `invite_token`

**–û–ø–ª–∞—Ç–∞ –≤ Mini App**

- –í Mini App –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥–∞—Ä–∏—Ç—å¬ª ‚Üí –±—ç–∫–µ–Ω–¥ —Å–æ–∑–¥–∞—ë—Ç invoice ‚Üí –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç invoice –≤ —á–∞—Ç
- –ü–ª–∞—Ç—ë–∂ Stars –∏–¥—ë—Ç —á–µ—Ä–µ–∑ Bot Payments: `pre_checkout_query` / `successful_payment`

---

## 4. –ë–∞–ª–∞–Ω—Å –≤–ª–∞–¥–µ–ª—å—Ü–∞

–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –º–æ–¥–µ–ª–∏:

```
–ë–∞–ª–∞–Ω—Å: –≤—Å–µ–≥–æ / –¥–æ—Å—Ç—É–ø–Ω–æ –∫ –≤—ã–≤–æ–¥—É / –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ (21 –¥–µ–Ω—å)
```

- Stars –¥–æ—Å—Ç—É–ø–Ω—ã –∫ –≤—ã–≤–æ–¥—É —á–µ—Ä–µ–∑ **21 –¥–µ–Ω—å**
- –ú–∏–Ω–∏–º–∞–ª–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ (—á–∞—Å—Ç–æ 1000 Stars)

---

## 5. API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/wishlist/by-slug/:slug` | –í–∏—à–ª–∏—Å—Ç + –ø—Ä–æ—Ñ–∏–ª—å –ø–æ public_slug |
| GET | `/api/wishlist/access` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (slug, telegram_id, invite_token) |
| POST | `/api/wishlist/access-request` | –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ (allowlist) |
| POST | `/api/wishlist/access-approve` | –í–ª–∞–¥–µ–ª–µ—Ü: –æ–¥–æ–±—Ä–∏—Ç—å/–æ—Ç–∫–ª–æ–Ω–∏—Ç—å |
| POST | `/api/orders` | –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ (—Ä–µ–∑–µ—Ä–≤ –ø–æ–∑–∏—Ü–∏–∏) |
| POST | `/api/payments/invoice` | –°–æ–∑–¥–∞—Ç—å Invoice –¥–ª—è item_id |
| POST | `/api/payments/telegram-webhook` | pre_checkout, successful_payment |
| GET | `/api/models/balance` | –ë–∞–ª–∞–Ω—Å: total / available / pending |

---

## 6. –°—Ö–µ–º–∞ –ë–î

–°–º. **DATABASE_SCHEMA_V2.sql**:

- `model_profiles`: `public_slug`, `privacy_mode` (public | invite_token | allowlist)
- `wishlist_items`: `item_status` (available | reserved | gifted)
- `orders`: order_id (UUID), item_id, amount_xtr, status, telegram_payment_charge_id, reserved_until
- `invite_tokens`: token, model_id, max_uses, expires_at
- `wishlist_allowed_users`: model_id, telegram_id
- `wishlist_access_requests`: model_id, requester_telegram_id, status
- `model_balances`: total_stars_earned, available_for_withdrawal, pending_21_days

---

## 7. –≠–∫—Ä–∞–Ω—ã –∏ –∫–Ω–æ–ø–∫–∏ (–≥–æ—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

### –ü—É–±–ª–∏—á–Ω—ã–π

| –≠–∫—Ä–∞–Ω | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|-------|------------|
| –í–∏—à–ª–∏—Å—Ç | –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ + —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ |
| –ü–æ–∑–∏—Ü–∏—è | –ù–∞–∑–≤–∞–Ω–∏–µ, —Ü–µ–Ω–∞, **–ü–æ–¥–∞—Ä–∏—Ç—å ‚≠ê X** |
| –°—Ç–∞—Ç—É—Å—ã | –°–≤–æ–±–æ–¥–Ω–æ / –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ / –ü–æ–¥–∞—Ä–µ–Ω–æ |
| –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã | ¬´–ü–æ–¥–∞—Ä–æ–∫ –æ–ø–ª–∞—á–µ–Ω ‚≠ê X. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É?¬ª ‚Üí **–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ** / **–ë–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è** |

### –ü–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é (—Ç–æ–∫–µ–Ω)

| –≠–∫—Ä–∞–Ω | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|-------|------------|
| –ò–Ω–≤–∞–π—Ç | ¬´–í–∞—Å –ø—Ä–∏–≥–ª–∞—Å–∏–ª–∏ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –≤–∏—à–ª–∏—Å—Ç &lt;–∏–º—è&gt;¬ª |
| –ö–Ω–æ–ø–∫–∏ | **–û—Ç–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫** / **–û—Ç–º–µ–Ω–∞** |
| –¢–æ–∫–µ–Ω –∏—Å—Ç—ë–∫ | ¬´–°—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ –Ω–æ–≤—É—é —É –≤–ª–∞–¥–µ–ª—å—Ü–∞.¬ª |

### –ü–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é (allowlist)

| –≠–∫—Ä–∞–Ω | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|-------|------------|
| –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ | ¬´–≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –≤–∏—à–ª–∏—Å—Ç. –ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–æ—Å—Ç—É–ø?¬ª |
| –ö–Ω–æ–ø–∫–∏ | **–ó–∞–ø—Ä–æ—Å–∏—Ç—å** / **–ù–∞–∑–∞–¥** |
| –í–ª–∞–¥–µ–ª–µ—Ü | ¬´–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –æ—Ç @username¬ª ‚Üí **–†–∞–∑—Ä–µ—à–∏—Ç—å** / **–û—Ç–∫–ª–æ–Ω–∏—Ç—å** |

---

## 8. –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –∏ –≤—ã–ø–ª–∞—Ç—ã –≤–ª–∞–¥–µ–ª—å—Ü—É

–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

1. **–í–ª–∞–¥–µ–ª–µ—Ü –≤—ã–≤–æ–¥–∏—Ç Stars —Å–∞–º** ‚Äî —Å–µ—Ä–≤–∏—Å —Ç–æ–ª—å–∫–æ –¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.
2. **–°–µ—Ä–≤–∏—Å —Å–æ–±–∏—Ä–∞–µ—Ç Stars –∏ –ø–ª–∞—Ç–∏—Ç –≤–ª–∞–¥–µ–ª—å—Ü—É** ‚Äî —Ä–µ–µ—Å—Ç—Ä –≤—ã–ø–ª–∞—Ç, –∫–æ–º–∏—Å—Å–∏–∏, KYC.
